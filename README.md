# xTurnover: Expected Turnover Model for Football Pass Analysis

A machine learning pipeline that predicts the probability of
turnovers in football passes using mixed-effects logistic regression
with cross-validation. This implementation is based on the methodology
published in the *Journal of Sports Sciences* and provides an automated
system for calculating Expected Pass Turnover (xTurnover) metrics in football
analytics.

**"Predicting turnovers in football using spatial and contextual data:
An expected turnover model"**\
*Journal of Sports Sciences*, 2024\
DOI: 10.1080/02640414.2024.2379697

üîó [Link to Paper](https://www.tandfonline.com/doi/full/10.1080/02640414.2024.2379697)

## Data Requirements

**Before using this model, you must ensure your dataset contains all
required variables.** Some features require preprocessing from
positional data and cannot be generated by this modeling
pipeline alone.


### Required Preprocessing Steps

1.  **Positional Feature Engineering**: This repository includes a transparent and fully documented workflow for constructing positional features from StatsBomb 360 freeze-frames (2020/21 Premier League). The full methodology‚Äîincluding directional teammate options, pressure radii, coordinate scaling, and join logic‚Äîis described here:

üëâ [Positional Feature Engineering](docs/positional_features.md)

This ensures reproducibility and matches the feature-engineering approach described by Peters et al. in the original xTurnover research.

![Positional Features](figures/Positional_Features.png)

2.  **Data Structure Compliance**: Your dataset must contain all
    variables listed in the "Model Inputs" section.
3.  **Variable Naming**: Column names must match exactly as specified.

**This model assumes you have already processed your raw data to include
all required features.**

**Note:** There is sample data provided in this repository: [sample_data.csv](sample_data.csv).

In addition, there is a sample output folder: [turnover_model_results_20251114_155537/](turnover_model_results).


## üìä Model Inputs

All variables listed below must be present in your dataset
before running the model.

### Basic Event Data

-   `turnover_count`
-   `player.name`
-   `match_id`
-   `position_group`

### Spatial Features

-   `x`, `y`
-   `distance_ball_moved`
-   `ball_movement_speed`
-   `percent_distance`
-   `pass.angle`

### Contextual Features

-   `play_pattern.name`
-   `pass.type.name`

### Pressing Features (from positional data)

-   `pressing_count_1`
-   `pressing_count_2`
-   `pressing_count_3`

### Teammate Orientation Features (from positional data)

-   `right_option`, `front_option`, `left_option`, `back_option`

## üîß Data Preprocessing Requirements

### Step 1: Positional Data Processing

-   Calculate pressing variables ( radii)\
-   Calculate orientation variables (directional quadrant availability)

### Step 2: Data Validation

R required columns check:

    required_columns <- c(
      "turnover_count", "x", "y", "distance_ball_moved", "ball_movement_speed",
      "percent_distance", "pass.angle", "pressing_count_1", "pressing_count_2", 
      "pressing_count_3", "play_pattern.name", "pass.type.name",
      "right_option", "front_option", "left_option", "back_option",
      "player.name", "match_id", "position_group"
    )

## üöÄ Quick Start

### Prerequisites

    install.packages(c("lme4", "dplyr", "pROC"))

### Command Line Execution

    chmod +x run_turnover_model.sh
    ./run_turnover_model.sh your_prepared_data.csv

### R Interactive Usage

    source("cross_validate_turnover_model.R")
    data <- read.csv("your_prepared_data.csv")
    cv_results <- cross_validate_turnover_model(
      data = data,
      outcome_var = "turnover_count",
      k_folds = 5,
      seed = 123,
      verbose = TRUE
    )


## üö® Common Issues and Solutions

-   Missing pressing variables ‚Üí compute using positional data.
-   Missing orientation variables ‚Üí compute using positional data.
-   Convergence errors ‚Üí check variable types, missingness, sample size.

## üìä Generated Outputs

-   `dataset_with_xTurnover.csv`
-   `model_summary_statistics.csv`
-   `fold_details.csv`
-   `confusion_matrix.csv`
-   `all_predictions.csv`
-   `model_report.txt`
-   `complete_cv_results.rds`

------------------------------------------------------------------------

# üîç Example Research Workflow

## 1. **Data Preparation**

Ensure your dataset meets the paper's specifications and includes all
required preprocessing (pressing, orientation, spatial features).

------------------------------------------------------------------------

## 2. **Model Execution**

``` bash
./run_turnover_model.sh premier_league_data.csv
```

------------------------------------------------------------------------

## 3. **Results Analysis**

-   Review `model_report.txt` for performance summary\
-   Analyze `dataset_with_xTurnover.csv` for insights\
-   Use statistical tests to validate empirical findings

------------------------------------------------------------------------

## 4. **Research Extension (R Example)**

``` r
# Load results for further analysis
results <- readRDS("complete_cv_results.rds")

# Analyze player-specific patterns
player_analysis <- results$xTurnover_dataset %>%
  group_by(player.name) %>%
  summarise(
    avg_xTurnover = mean(xTurnover, na.rm = TRUE),
    actual_turnover_rate = mean(turnover_count),
    decision_quality = actual_turnover_rate - avg_xTurnover
  )
```

------------------------------------------------------------------------

# üîß Customisation

## **Model Parameters**

Modify `turnover_cv_analysis.R` to adjust:

-   Number of folds (`k_folds`)
-   Optimizer selection (`optimizer`)
-   Maximum iterations (`max_iterations`)
-   Random seed (`seed`)

## **Output Options**

You may edit the script to change:

-   Output filenames.
-   Additional summary statistics.
-   Custom plots or visualisations.

------------------------------------------------------------------------

# üìö Citation

### **If using the methodology, cite:**

    @article{xTurnover2024,
      title={Predicting turnovers in football using spatial and contextual data: An expected turnover model},
      author={[Author Names]},
      journal={Journal of Sports Sciences},
      year={2024},
      doi={10.1080/02640414.2024.2379697},
      url={https://www.tandfonline.com/doi/epdf/10.1080/02640414.2024.2379697}
    }

### **If using the software implementation, cite:**

    @software{xTurnover_implementation,
      title={xTurnover: Expected Turnover Model Implementation},
      author={[Your Name]},
      year={2024},
      url={https://github.com/[your-repo]},
      note={Implementation of methodology from Journal of Sports Sciences}
    }

------------------------------------------------------------------------

# ü§ù Contributing

We welcome extensions, replications, and methodological improvements.

1.  Fork the repository\

2.  Create a feature branch:

    ``` bash
    git checkout -b feature/AmazingFeature
    ```

3.  Test your changes with sample data\

4.  Commit:

    ``` bash
    git commit -m "Add some AmazingFeature"
    ```

5.  Push:

    ``` bash
    git push origin feature/AmazingFeature
    ```

6.  Open a Pull Request

------------------------------------------------------------------------

# üìÑ License

This project is distributed under the **MIT License**. See `LICENSE` for
details.

------------------------------------------------------------------------

# üìß Contact


### **Technical Support**

-   Check `model_report.txt` for detailed model diagnostics.
-   Ensure all required variables are present in your dataset.
-   Open an issue with sample data + error logs.

------------------------------------------------------------------------

# üèÜ Acknowledgments

This implementation builds upon peer-reviewed research published in the
*Journal of Sports Sciences*.

We acknowledge the authors, reviewers, and editorial team for advancing
football analytics research.

**Research Note:**
Model performance may vary across leagues, seasons, and
contexts (you must validate on your own dataset).
